# ุชุดุฎูุต ูุดููุฉ ุงูุชุนูููุงุช

## ๐ ุฎุทูุงุช ุงูุชุดุฎูุต

### ุงูุฎุทูุฉ 1: ุชุญูู ูู Console ุงููุชุตูุญ

1. **ุงูุชุญ Developer Tools**
   - ุงุถุบุท F12 ูู ุงููุชุตูุญ
   - ุงุฐูุจ ุฅูู ุชุจููุจ "Console"

2. **ุญุงูู ุฅุถุงูุฉ ุชุนููู**
   - ุงูุชุจ ุชุนููู ูุงุถุบุท "ุฅุฑุณุงู"
   - ุงูุธุฑ ููุฃุฎุทุงุก ูู Console

3. **ุงุจุญุซ ุนู ุงูุฎุทุฃ**
   - ุฅุฐุง ุฑุฃูุช "permission denied" โ ูุดููุฉ ูู RLS Policy
   - ุฅุฐุง ุฑุฃูุช "relation does not exist" โ ุงูุฌุฏูู ุบูุฑ ููุฌูุฏ
   - ุฅุฐุง ุฑุฃูุช "column does not exist" โ ูุดููุฉ ูู ุฃุณูุงุก ุงูุฃุนูุฏุฉ

### ุงูุฎุทูุฉ 2: ุชุญูู ูู ุงูุฌุฏูู ูู Supabase

1. **ุงูุชุญ Table Editor**
   - ุงุฐูุจ ุฅูู Supabase Dashboard
   - Table Editor โ task_comments

2. **ุชุญูู ูู ุงูุฃุนูุฏุฉ**
   ูุฌุจ ุฃู ุชุฑู:
   - โ id (uuid)
   - โ task_id (uuid)
   - โ user_id (uuid)
   - โ content (text)
   - โ created_at (timestamptz)
   - โ updated_at (timestamptz)

### ุงูุฎุทูุฉ 3: ุชุญูู ูู RLS Policies

1. **ุงูุชุญ Authentication โ Policies**
   - ุงุจุญุซ ุนู task_comments

2. **ูุฌุจ ุฃู ุชุฑู 4 policies:**
   - โ SELECT: "Everyone can view comments"
   - โ INSERT: "Authenticated users can create comments"
   - โ UPDATE: "Users can update own comments"
   - โ DELETE: "Users can delete own comments"

3. **ุชุญูู ูู INSERT Policy**
   - ุงุถุบุท ุนูู policy "Authenticated users can create comments"
   - ูุฌุจ ุฃู ูููู WITH CHECK: `user_id = auth.uid()`

### ุงูุฎุทูุฉ 4: ุงุฎุชุจุงุฑ ูุฏูู ูู SQL Editor

```sql
-- 1. ุชุญูู ูู ุงููุณุชุฎุฏู ุงูุญุงูู
SELECT auth.uid() as current_user_id;

-- 2. ุงุญุตู ุนูู ID ูููุฉ
SELECT id, title FROM tasks LIMIT 1;

-- 3. ุญุงูู ุฅุถุงูุฉ ุชุนููู ูุฏููุงู
-- ุงุณุชุจุฏู 'task-id-here' ุจู ID ูููุฉ ุญููููุฉ
INSERT INTO task_comments (task_id, user_id, content)
VALUES (
  'task-id-here',
  auth.uid(),
  'ุชุนููู ุชุฌุฑูุจู'
);

-- 4. ุชุญูู ูู ุงูุชุนููู
SELECT * FROM task_comments ORDER BY created_at DESC LIMIT 1;
```

## ๐ง ุงูุญููู ุงูุดุงุฆุนุฉ

### ุงูุญู 1: ุชุญุฏูุซ INSERT Policy

ุฅุฐุง ูุงูุช ุงููุดููุฉ ูู ุงูุตูุงุญูุงุช:

```sql
-- ุดุบู ูุฐุง ูู SQL Editor
DROP POLICY IF EXISTS "Authenticated users can create comments" ON task_comments;

CREATE POLICY "Authenticated users can create comments"
  ON task_comments FOR INSERT
  WITH CHECK (user_id = auth.uid());
```

ุฃู ุงุณุชุฎุฏู ุงูููู ุงูุฌุงูุฒ: `fix_comments_policy.sql`

### ุงูุญู 2: ุฅุนุงุฏุฉ ุฅูุดุงุก ุงูุฌุฏูู

ุฅุฐุง ูุงู ุงูุฌุฏูู ุจู ูุดุงูู:

```sql
-- ุงุญุฐู ุงูุฌุฏูู ุงููุฏูู
DROP TABLE IF EXISTS task_comments CASCADE;

-- ุซู ุดุบู migration ูุงูู ูู:
-- supabase/migrations/20240106_task_comments.sql
```

### ุงูุญู 3: ุชุนุทูู RLS ูุคูุชุงู (ููุงุฎุชุจุงุฑ ููุท!)

```sql
-- ุชุนุทูู RLS ููุงุฎุชุจุงุฑ
ALTER TABLE task_comments DISABLE ROW LEVEL SECURITY;

-- ุฌุฑุจ ุฅุถุงูุฉ ุชุนููู
-- ุฅุฐุง ูุฌุญุ ุงููุดููุฉ ูู RLS Policies

-- ุฃุนุฏ ุชูุนูู RLS
ALTER TABLE task_comments ENABLE ROW LEVEL SECURITY;
```

## ๐ ูุงุฆูุฉ ุงูุชุญูู

- [ ] ุงูุฌุฏูู task_comments ููุฌูุฏ
- [ ] ุงูุฌุฏูู ูุญุชูู ุนูู 6 ุฃุนูุฏุฉ
- [ ] RLS ููุนู ููุฌุฏูู
- [ ] 4 Policies ููุฌูุฏุฉ
- [ ] INSERT Policy ุตุญูุญุฉ (user_id = auth.uid())
- [ ] ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู (auth.uid() ููุณ null)
- [ ] ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู Console

## ๐ ุฃุฎุทุงุก ุดุงุฆุนุฉ ูุญููููุง

### ุฎุทุฃ: "new row violates row-level security policy"

**ุงูุณุจุจ:** INSERT Policy ุฎุงุทุฆุฉ

**ุงูุญู:**
```sql
DROP POLICY IF EXISTS "Authenticated users can create comments" ON task_comments;
CREATE POLICY "Authenticated users can create comments"
  ON task_comments FOR INSERT
  WITH CHECK (user_id = auth.uid());
```

### ุฎุทุฃ: "null value in column user_id"

**ุงูุณุจุจ:** ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ุฏุฎูู ุฃู profile.id ุบูุฑ ุตุญูุญ

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู
2. ุชุญูู ูู auth.uid() ูู SQL Editor
3. ุชุญูู ูู profile.id ูู ุงูููุฏ

### ุฎุทุฃ: "foreign key violation"

**ุงูุณุจุจ:** task_id ุบูุฑ ููุฌูุฏ

**ุงูุญู:**
1. ุชุญูู ูู ุฃู ุงููููุฉ ููุฌูุฏุฉ
2. ุชุญูู ูู taskId ูู ุงูููุฏ

## ๐ ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ

1. **ุฃุฑุณู ูู screenshot ูู:**
   - Console errors (F12)
   - RLS Policies ูู Supabase
   - ุงูุฌุฏูู ูู Table Editor

2. **ุดุบู ูุฐุง ุงูุฃูุฑ ูุฃุฑุณู ุงููุชูุฌุฉ:**
```sql
-- ูุนูููุงุช ุงูุชุดุฎูุต
SELECT 
  'Current User' as info,
  auth.uid() as value
UNION ALL
SELECT 
  'Table Exists',
  CASE WHEN EXISTS (
    SELECT 1 FROM information_schema.tables 
    WHERE table_name = 'task_comments'
  ) THEN 'Yes' ELSE 'No' END
UNION ALL
SELECT 
  'RLS Enabled',
  CASE WHEN relrowsecurity THEN 'Yes' ELSE 'No' END
FROM pg_class
WHERE relname = 'task_comments';
```

---

**ุงุชุจุน ูุฐู ุงูุฎุทูุงุช ูุชุดุฎูุต ูุญู ุงููุดููุฉ!** ๐
